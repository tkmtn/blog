<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>2022å¹´1æœˆ25æ—¥ã€€ç¡çœ ç›£è¦–ãƒ„ã‚¤ãƒ¼ãƒˆã«ã¤ã„ã¦è§£èª¬ - tsukumotan blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2022å¹´1æœˆ25æ—¥ã€€ç¡çœ ç›£è¦–ãƒ„ã‚¤ãƒ¼ãƒˆã«ã¤ã„ã¦è§£èª¬" />
<meta property="og:description" content="ç¡çœ çŠ¶æ³ã‚’ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ otokura1922ã¯ç§ã®Twitterã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã™ã€‚ ã§ã‚‚ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¯è¦‹ã¦ãªã„ã—ç§ãŒæ‰‹å‹•ã§ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚‚ã‚ã‚Š" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tkmtn.github.io/blog/posts/20220125/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-25T13:06:50+09:00" />
<meta property="article:modified_time" content="2022-01-25T13:06:50+09:00" />


		<meta itemprop="name" content="2022å¹´1æœˆ25æ—¥ã€€ç¡çœ ç›£è¦–ãƒ„ã‚¤ãƒ¼ãƒˆã«ã¤ã„ã¦è§£èª¬">
<meta itemprop="description" content="ç¡çœ çŠ¶æ³ã‚’ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ otokura1922ã¯ç§ã®Twitterã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã™ã€‚ ã§ã‚‚ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¯è¦‹ã¦ãªã„ã—ç§ãŒæ‰‹å‹•ã§ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚‚ã‚ã‚Š"><meta itemprop="datePublished" content="2022-01-25T13:06:50+09:00" />
<meta itemprop="dateModified" content="2022-01-25T13:06:50+09:00" />
<meta itemprop="wordCount" content="1931">
<meta itemprop="keywords" content="" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/blog/css/style.css">
	<link rel="stylesheet" href="/blog/css/custom.css">

	<link rel="shortcut icon" href="/blog/favicon.ico">
		
</head>
<body class="body" oncontextmenu="alert('å³ã‚¯ãƒªç¦æ­¢ï¼ã‚­ãƒªç•ªã¯ã‚³ãƒ¡ãƒ³ãƒˆã§æ•™ãˆã¦ã­ï¼')">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/blog/" title="tsukumotan blog" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/blog/img/mirei.png">
				</div><div class="logo__item logo__text">
					<div class="logo__title">tsukumotan blog</div>
					<div class="logo__tagline">ã‚³ãƒ¡ãƒ³ãƒˆå¾…ã£ã¦ã‚‹ã‚ˆâ™¡ã€€Twitterã‚’ã‚„ã‚ã¦ãƒ–ãƒ­ã‚°ã‚’å§‹ã‚ã‚ˆã†ï¼ç›¸äº’ãƒªãƒ³ã‚¯ã¯ã‚³ãƒ¡ãƒ³ãƒˆã§ï¼</div>
				</div>
		</a>
		<div class="access_counter logo__item">
			ã‚¢ã‚¯ã‚»ã‚¹ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼š
			<iframe width="100" height="50" src="https://asia-northeast1-river-nation-311307.cloudfunctions.net/tkmtn-blog-ac-counter-1" frameborder="0"></iframe>
		</div>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/blog/">
				
				<span class="menu__text">ãƒ›ãƒ¼ãƒ </span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/blog/posts/">
				
				<span class="menu__text">æŠ•ç¨¿ä¸€è¦§</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2022å¹´1æœˆ25æ—¥ã€€ç¡çœ ç›£è¦–ãƒ„ã‚¤ãƒ¼ãƒˆã«ã¤ã„ã¦è§£èª¬</h1>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2 0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class="meta__text">ã¤ãã‚‚ãŸã‚“</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2022-01-25T13:06:50&#43;09:00">2022-01-25</time></div></div>
		</header>
		
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#notifyã‚¢ãƒ—ãƒªã§intentã‚’ç™ºè¡Œ">notifyã‚¢ãƒ—ãƒªã§intentã‚’ç™ºè¡Œ</a></li>
    <li><a href="#google-cloud-platformã§è‡ªå‹•ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹">Google Cloud Platformã§è‡ªå‹•ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹</a>
      <ul>
        <li><a href="#cloud-firestoreã«ç¡çœ æ™‚é–“ã‚’è¨˜éŒ²ã™ã‚‹dbã‚’ä½œã‚‹">Cloud Firestoreã«ç¡çœ æ™‚é–“ã‚’è¨˜éŒ²ã™ã‚‹DBã‚’ä½œã‚‹</a></li>
        <li><a href="#cloud-functionsã§ç¡çœ ç›£è¦–ã‚’å—ã‘å–ã‚‹é–¢æ•°ã‚’ä½œã‚‹">Cloud Functionsã§ç¡çœ ç›£è¦–ã‚’å—ã‘å–ã‚‹é–¢æ•°ã‚’ä½œã‚‹</a></li>
      </ul>
    </li>
    <li><a href="#taskerã‹ã‚‰cloud-functionsã«httpãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹">Taskerã‹ã‚‰Cloud Functionsã«HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹</a>
      <ul>
        <li><a href="#taskerã§ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹">Taskerã§ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹</a></li>
      </ul>
    </li>
    <li><a href="#å‚è€ƒãƒªãƒ³ã‚¯">å‚è€ƒãƒªãƒ³ã‚¯</a></li>
  </ul>
</nav>
	</div>
</div><div class="content post__content clearfix">
			<h1 id="ç¡çœ çŠ¶æ³ã‚’ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹">ç¡çœ çŠ¶æ³ã‚’ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹</h1>
<p>otokura1922ã¯ç§ã®Twitterã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã™ã€‚</p>
<p>ã§ã‚‚ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¯è¦‹ã¦ãªã„ã—ç§ãŒæ‰‹å‹•ã§ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‹äººãŒä½•äººã‹ã„ã‚‹ã®ã§ãã®äººãŒãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</p>
<blockquote>
<p>*Auto*</p>
</blockquote>
<p>ã¨é ­ã«ã¤ã„ã¦ã„ã‚‹ã‚‚ã®ã¯Twitter APIã‚’ä½¿ç”¨ã—ãŸè‡ªå‹•ãƒ„ã‚¤ãƒ¼ãƒˆã§ã™ã€‚</p>
<p>ä»Šå›ã¯ã“ã‚Œã®ä¸­èº«ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚ç§ãŒã“ã‚Œã‚’ä½œã‚‹ã¨ãã¯å…¨éƒ¨ã‚°ã‚°ã£ãŸè¨˜äº‹ã‚’ãƒ‘ã‚¯ã‚ŠãªãŒã‚‰ä½œã‚Šã¾ã—ãŸã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®çŸ¥è­˜ãªã‚“ã¦ã»ã¨ã‚“ã©å¿…è¦ç„¡ã„ã§ã™ã—ã€ç°¡å˜ãªã®ã§çš†ã•ã‚“ã‚‚æ˜¯éä½œã£ã¦ã¿ã¦ãã ã•ã„ã­ã€‚</p>
<p>ã‚ˆã‚Šã‚ˆã„æ–¹æ³•ã‚’ãŠæŒã¡ã®æ–¹ã€ä»–ã®æ–¹æ³•ã§åŒã˜ã‚ˆã†ãªã“ã¨ã‚’ã‚„ã£ã¦ã‚‹æ–¹ãŒã„ã‚Œã°ãœã²ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã ã•ã„ã€‚</p>
<p>ã¡ãªã¿ã«ã€Twitterã®APIã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã¯Twitteré–‹ç™ºè€…ã«ãªã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<p><code>Twitterã€€é–‹ç™ºè€…ã€€ãªã‚Šæ–¹</code></p>
<p>ã¨ã‹ã§æ¤œç´¢ã™ã‚‹ã¨ãªã‚Šæ–¹ãŒå‡ºã¦ãã¾ã™ã€‚</p>
<p>ç§ã¯ä¸€åº¦ç”³è«‹ã‚’ãƒªã‚¸ã‚§ã‚¯ãƒˆã•ã‚Œã¾ã—ãŸãŒTwitterã®é–‹ç™ºè€…ãƒãƒªã‚·ãƒ¼çµ¶å¯¾å®ˆã‚Šã¾ã™ï¼ã¿ãŸã„ãªã“ã¨ã‚’ãƒ¡ãƒ¼ãƒ«ã—ãŸã‚‰ç„¡äº‹é–‹ç™ºè€…ã«ãªã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚</p>
<h1 id="ç¡çœ ç›£è¦–ã®æµã‚Œ">ç¡çœ ç›£è¦–ã®æµã‚Œ</h1>
<p><img src="/blog/images/sleepwatch.png" alt="sleepwatch"></p>
<p>Notify for Mi bandã¨Taskerã¨ã„ã†ã‚¢ãƒ—ãƒªã§ç¡çœ ã‚’GCPã«é€ã£ã¦ã„ã¾ã™ã€‚</p>
<p>ã¾ãšã€ç§ãŒèº«ã«ã¤ã‘ã¦ã„ã‚‹miband5ã§èµ·åºŠorå°±å¯ã‚’ç›£è¦–ã—ã¾ã™ã€‚ä¸‹ã®ã‚¹ã‚¯ã‚·ãƒ§ã®ã‚ˆã†ã«è¨­å®šã—ã¦ãŠãã¨ã€Notify for Mi bandã¨ã„ã†ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¢ãƒ—ãƒªã‹ã‚‰ã€èµ·åºŠãƒ»å°±å¯æ™‚ã«è‡ªå‹•çš„ã«intentãŒç™ºè¡Œã•ã‚Œã‚‹ã®ã§ã€ãã‚Œã‚’Taskerã§ã‚­ãƒ£ãƒƒãƒã—ã¾ã™ã€‚</p>
<p><img src="/blog/images/notify.jpg" alt="notify"></p>
<h2 id="notifyã‚¢ãƒ—ãƒªã§intentã‚’ç™ºè¡Œ">notifyã‚¢ãƒ—ãƒªã§intentã‚’ç™ºè¡Œ</h2>
<p>è©³ã—ã„æƒ…å ±ã¯ä¸‹ã®ãƒªãƒ³ã‚¯ã«è¨˜è¼‰ãŒã‚ã‚Šã¾ã™ã€‚</p>
<p><a href="https://www.mibandnotify.com/help/tasker_send_intent.php">Tasker integration</a></p>
<ul>
<li>èµ·åºŠæ™‚
<ul>
<li><code>com.mc.miband.startWakeUp</code></li>
</ul>
</li>
<li>å°±å¯æ™‚
<ul>
<li><code>com.mc.miband.tasker.fellAsleep</code></li>
</ul>
</li>
</ul>
<h2 id="google-cloud-platformã§è‡ªå‹•ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹">Google Cloud Platformã§è‡ªå‹•ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹</h2>
<p>ã»ã¨ã‚“ã©ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã ã‘ã§å®Œçµã—ã¾ã™ã€‚ã‚°ã‚°ã‚ŠãªãŒã‚‰ã‚„ã‚Œã°è¶…ç°¡å˜ã§ã™ã€‚</p>
<h3 id="cloud-firestoreã«ç¡çœ æ™‚é–“ã‚’è¨˜éŒ²ã™ã‚‹dbã‚’ä½œã‚‹">Cloud Firestoreã«ç¡çœ æ™‚é–“ã‚’è¨˜éŒ²ã™ã‚‹DBã‚’ä½œã‚‹</h3>
<p><a href="https://firebase.google.com/docs/firestore">Cloud Firestore</a></p>
<p>æ¬¡ã«ä½¿ã†Cloud Functionsã¯å¤‰æ•°ã‚’é•·æ™‚é–“ä¿æŒã§ããªã„ã®ã§ã€ã©ã“ã‹ã«å°±å¯æ™‚é–“ã‚’ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç§ã¯GCPã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã‚ã‚‹Firestoreã‚’ä½¿ã„ã¾ã—ãŸã€‚</p>
<p><img src="/blog/images/firestore.png" alt="firestore"></p>
<p>ä¸Šã®ç”»åƒã®é’è‰²ã®<strong>ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹</strong>ã¨ã‹<strong>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ </strong>ã¨ã‹ã‹ã‚‰ä»Šå›ä½¿ã†ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’è¿½åŠ ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚ã“ã®æ®µéšã§ä½œã£ã¦ãŠãã¾ã—ã‚‡ã†ã€‚</p>
<p>ç§ã¯æœ€æ–°ã®å°±å¯æ™‚åˆ»ã—ã‹è¨˜éŒ²ã—ã¦ã„ã¾ã›ã‚“ã€‚</p>
<h3 id="cloud-functionsã§ç¡çœ ç›£è¦–ã‚’å—ã‘å–ã‚‹é–¢æ•°ã‚’ä½œã‚‹">Cloud Functionsã§ç¡çœ ç›£è¦–ã‚’å—ã‘å–ã‚‹é–¢æ•°ã‚’ä½œã‚‹</h3>
<p><a href="https://cloud.google.com/functions?hl=ja">Google Cloud Functions(GCF)</a>ã¯ã„ã‚ã‚†ã‚‹FaaS(Function as a Service)ã¨å‘¼ã°ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã€ã‹ã‚“ãŸã‚“ãªè¨­å®šã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
<p>GCFã«ä¸‹ã®ã‚ˆã†ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç™»éŒ²ã—ã¦ã€HTTPã§å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ãŠãã¾ã™ã€‚ã“ã‚Œã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¥ã£ã¦ã„ã‚‹Hello Worldã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ”¹é€ ã—ã¦ä½œã‚Šã¾ã—ãŸã€‚</p>
<p>ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯python3.7ã§ã™ãŒã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ä½•ã§ã‚‚ã„ã„ã¨æ€ã„ã¾ã™ã€‚
Twitterã®ãƒˆãƒ¼ã‚¯ãƒ³ãªã©ã¯<a href="https://cloud.google.com/secret-manager">Secret Manager</a>ã«å…¥ã‚Œã¦ç’°å¢ƒå¤‰æ•°ã«ã—ã¦ã„ã¾ã™ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> datetime
<span style="color:#f92672">from</span> google.cloud <span style="color:#f92672">import</span> firestore
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> tweepy
<span style="color:#f92672">import</span> os

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sleep_watch</span>(request):
    <span style="color:#e6db74">&#34;&#34;&#34;Responds to any HTTP request.
</span><span style="color:#e6db74">    Args:
</span><span style="color:#e6db74">        request (flask.Request): HTTP request object.
</span><span style="color:#e6db74">    Returns:
</span><span style="color:#e6db74">        The response text or any set of values that can be turned into a
</span><span style="color:#e6db74">        Response object using
</span><span style="color:#e6db74">        `make_response &lt;http://flask.pocoo.org/docs/1.0/api/#flask.Flask.make_response&gt;`.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    request_json <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>get_json()
    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;POST&#39;</span>:
        <span style="color:#66d9ef">if</span> request_json <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;content&#39;</span> <span style="color:#f92672">in</span> request_json:
            <span style="color:#66d9ef">if</span> request_json[<span style="color:#e6db74">&#39;content&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;fell_asleep&#39;</span>:
                aslp()
                tweet(<span style="color:#e6db74">&#39;*Auto*</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">ãŠã‚„ã™ã¿ãªã•ã„&#39;</span>)
                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;fell asleep&#39;</span>
            <span style="color:#66d9ef">elif</span> request_json[<span style="color:#e6db74">&#39;content&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;wake_up&#39;</span>:
                <span style="color:#75715e"># æœ€æ–°ã®å°±å¯æ™‚åˆ»ã‹ã‚‰ç¾åœ¨æ™‚åˆ»ã‚’å¼•ã„ã¦ã€å…¨ç§’æ•°ã‹ã‚‰æ™‚é–“ã€åˆ†ã‚’è¨ˆç®—ã™ã‚‹ã€‚</span>
                slptime <span style="color:#f92672">=</span> wake()
                sec <span style="color:#f92672">=</span> slptime<span style="color:#f92672">.</span>total_seconds()
                hours, amari <span style="color:#f92672">=</span> divmod(sec, <span style="color:#ae81ff">3600</span>)
                minutes, secs <span style="color:#f92672">=</span> divmod(amari, <span style="color:#ae81ff">60</span>)
                slptime_formated <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>int(hours)<span style="color:#e6db74">}</span><span style="color:#e6db74">æ™‚é–“</span><span style="color:#e6db74">{</span>int(minutes)<span style="color:#e6db74">}</span><span style="color:#e6db74">åˆ†&#39;</span>
                tweet(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;*Auto*</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">ç¡çœ æ™‚é–“ï¼š</span><span style="color:#e6db74">{</span>slptime_formated<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
                <span style="color:#66d9ef">return</span> slptime_formated

<span style="color:#75715e"># Firestore</span>
db <span style="color:#f92672">=</span> firestore<span style="color:#f92672">.</span>Client(project<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID&#34;</span>)
doc_ref <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>collection(<span style="color:#e6db74">&#39;sleepwatch&#39;</span>)<span style="color:#f92672">.</span>document(<span style="color:#e6db74">&#39;time&#39;</span>)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">aslp</span>():
    doc_ref<span style="color:#f92672">.</span>set({<span style="color:#e6db74">&#39;fell_asleep_time&#39;</span>:datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>utcnow()})

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">wake</span>():
    doc <span style="color:#f92672">=</span> doc_ref<span style="color:#f92672">.</span>get()<span style="color:#f92672">.</span>to_dict()[<span style="color:#e6db74">&#39;fell_asleep_time&#39;</span>]
    now <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>utcnow()<span style="color:#f92672">.</span>replace(tzinfo<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>)
    slptime <span style="color:#f92672">=</span> now <span style="color:#f92672">-</span> doc<span style="color:#f92672">.</span>replace(tzinfo<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>)
    <span style="color:#66d9ef">return</span> slptime

<span style="color:#75715e"># Twitter</span>
tw_auth <span style="color:#f92672">=</span> tweepy<span style="color:#f92672">.</span>OAuthHandler(os<span style="color:#f92672">.</span>getenv(<span style="color:#e6db74">&#39;TW_API_KEY&#39;</span>), os<span style="color:#f92672">.</span>getenv(<span style="color:#e6db74">&#39;TW_API_SECRET&#39;</span>))
tw_auth<span style="color:#f92672">.</span>set_access_token(os<span style="color:#f92672">.</span>getenv(<span style="color:#e6db74">&#39;TW_ACCESS_TOKEN&#39;</span>), os<span style="color:#f92672">.</span>getenv(<span style="color:#e6db74">&#39;TW_ACCESS_TOKEN_SECRET&#39;</span>))
api <span style="color:#f92672">=</span> tweepy<span style="color:#f92672">.</span>API(tw_auth)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tweet</span>(content):
    <span style="color:#66d9ef">try</span>:
        api<span style="color:#f92672">.</span>update_status(content)
    <span style="color:#66d9ef">except</span>:
        <span style="color:#75715e"># é€£ç¶šã§åŒã˜å†…å®¹ã‚’æŠ•ç¨¿ã§ããªã„ã®ã§ã€ã‚¨ãƒ©ãƒ¼ãŒå¸°ã£ã¦ããŸã‚‰ç¾åœ¨æ™‚åˆ»ï¼ˆUTCï¼‰ã‚’æœ«å°¾ã«ä»˜åŠ ã—ã¦ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹ã€‚</span>
        api<span style="color:#f92672">.</span>update_status(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>content<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{</span>datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>now()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><h2 id="taskerã‹ã‚‰cloud-functionsã«httpãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹">Taskerã‹ã‚‰Cloud Functionsã«HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹</h2>
<h3 id="taskerã§ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹">Taskerã§ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹</h3>
<p>Taskerã§å…ˆç¨‹ä½œæˆã—ãŸGCFã®é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’2ã¤ä½œæˆã—ã¾ã™ã€‚å°±å¯ç”¨ã¨èµ·åºŠç”¨ã§ã™ã€‚</p>
<p>HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã€URLã¯å…ˆã®é–¢æ•°ã®ãƒˆãƒªã‚¬ãƒ¼ã€ãƒ¡ã‚½ãƒƒãƒ‰ã¯POSTã€æœ¬æ–‡ã¯<code>{&quot;content&quot;:&quot;wake_up&quot;}</code>ï¼ˆèµ·åºŠï¼‰ã¾ãŸã¯<code>{&quot;content&quot;:&quot;fell_asleep&quot;}</code>ï¼ˆå°±å¯ï¼‰ã§ã™ã€‚Sttucture Output(JSON,etc)ã«ã‚‚ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¾ã™ã€‚
<img src="/blog/images/tasker4.jpg" alt="tasker"></p>
<p>æ¬¡ã«ã€ä¸‹ã®ã‚ˆã†ã«ã€èµ·åºŠã¨å°±å¯2ã¤ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¦ä½œæˆã—ãŸã‚¿ã‚¹ã‚¯ã«ç´ä»˜ã‘ã¦å®Œæˆã§ã™ã€‚
<img src="/blog/images/tasker2.jpg" alt="tasker"></p>
<h2 id="å‚è€ƒãƒªãƒ³ã‚¯">å‚è€ƒãƒªãƒ³ã‚¯</h2>
<ul>
<li><a href="https://play.google.com/store/apps/details?id=net.dinglisch.android.taskerm&amp;hl=ja&amp;gl=US">Google Play Tasker</a></li>
<li><a href="https://play.google.com/store/apps/details?id=net.dinglisch.android.taskerm&amp;hl=ja&amp;gl=US">Google Play Notify for Mi Band</a></li>
<li><a href="https://firebase.google.com/docs/firestore">GCP Cloud Firestore</a></li>
<li><a href="https://cloud.google.com/functions?hl=ja">GCP Cloud Functions</a></li>
<li><a href="https://www.mibandnotify.com/help/tasker_send_intent.php">Tasker integration</a></li>
</ul>
<h1 id="æ—¥è¨˜">æ—¥è¨˜</h1>
<p>é«ªã‚’åˆ‡ã‚Šã¾ã—ãŸï¼ˆ71æ—¥ã¶ã‚Šï¼‰</p>

		</div>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="ã¤ãã‚‚ãŸã‚“ avatar" src="/blog/img/mirei.png" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About ã¤ãã‚‚ãŸã‚“</span>
	</div>
	<div class="authorbox__description">
		<pre><code>    æ¯æ—¥10æ™‚é–“ç¡çœ 
    ğ‘ğ‘œğ‘šğ‘ğ‘™ğ‘’ğ‘¡ğ‘’ ğ‘â„ğ‘¦ğ‘ ğ‘–ğ‘ğ‘ğ‘™, ğ‘šğ‘’ğ‘›ğ‘¡ğ‘ğ‘™ ğ‘ğ‘›ğ‘‘ ğ‘ ğ‘œğ‘ğ‘–ğ‘ğ‘™ ğ‘¤ğ‘’ğ‘™ğ‘™-ğ‘ğ‘’ğ‘–ğ‘›ğ‘” ğ‘ğ‘›ğ‘‘ ğ‘›ğ‘œğ‘¡ ğ‘šğ‘’ğ‘Ÿğ‘’ğ‘™ğ‘¦ ğ‘¡â„ğ‘’ ğ‘ğ‘ğ‘ ğ‘’ğ‘›ğ‘ğ‘’ ğ‘œğ‘“ ğ‘‘ğ‘–ğ‘ ğ‘’ğ‘ğ‘ ğ‘’ ğ‘œğ‘Ÿ ğ‘–ğ‘›ğ‘“ğ‘–ğ‘Ÿğ‘šğ‘–ğ‘¡ğ‘¦
    discordï¼š otkr#3355
    21æ™‚ï½24æ™‚ãŒç§ã®ã‚³ã‚¢ã‚¿ã‚¤ãƒ ã§ã™ã€‚æ°—è»½ã«é›»è©±ã‹ã‘ã¦ãã ã•ã„ã€‚
</code></pre>

	</div>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/blog/posts/20220124/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">2022å¹´1æœˆ25æ—¥ã€€ã‚¢ã‚¯ã‚»ã‚¹ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®è¨­ç½®</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/blog/posts/20220127/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">2022å¹´1æœˆ27æ—¥ã€€å³ã‚¯ãƒªç¦æ­¢</p>
		</a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tsukumotan-blog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2022 tsukumotan.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/blog/js/menu.js"></script>
<script src="/blog/js/custom.js"></script></body>
</html>